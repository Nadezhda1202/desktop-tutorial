# Настройка селекторов

Программному роботу для имитации конкретных действий в интерфейсе пользователя (операционной системе, программах, веб-страницах) необходимо взаимодействовать с различными окнами, кнопками, раскрывающимися списками, гиперссылками и так далее. В действиях с экранными формами Sherpa RPA осуществляет поиск (перебор) положения элементов на экране. При этом выбор нужного элемента на экране – это сложная задача, перебор может осуществляться среди нескольких тысяч элементов, которые присутствуют на экране.   Достаточно часто признаки элементов управления, по которым их можно найти на экране (названия, подписи, системные свойства и дескрипторы) подвержены динамическим изменениям, например, заголовок веб-страницы может измениться во время процесса автоматизации.

Для решения этой проблемы Дизайнер использует так называемые "Селекторы". Селекторы хранят атрибуты элемента графического интерфейса пользователя в виде набора инструкций в формате XML, которые подсказывают роботу, как найти тот или иной элемент управления на экране.

В большинстве случаев селекторы автоматически генерируются Дизайнером в процессе записи действий пользователя и не требуют дополнительного ввода от пользователя, особенно если автоматизируемые приложения имеют статический интерфейс пользователя.

<figure><img src="../../../../.gitbook/assets/image (76).png" alt=""><figcaption></figcaption></figure>

**Селектор** – подсказка, руководство к действию для робота, как ему найти на экране тот или иной элемент управления. Робот записывает эти селекторы автоматически при записи каких-либо действий.

Однако в некоторых программах используются изменяемые макеты и атрибуты с изменчивыми значениями, например в веб-приложениях. Дизайнер не может предсказать эти изменения, поэтому некоторые селекторы, возможно, придется создавать или редактировать вручную.

<figure><img src="../../../../.gitbook/assets/image (75).png" alt=""><figcaption></figcaption></figure>

## **Окно "Редактировать селектор"**

Окно "Редактировать селектор" вызывается из правой панели свойств селектора (только для тех блоков, в которых есть селекторы) нажатием на кнопку с многоточием.  Все блоки, связанные с графическими элементами, обладают этим свойством. Селектор доступен и в случае, когда Блоки добавляются в Проект с помощью инструмента "Запись", и в готовых блоках для операций с экранными формами (UI Automation) из палитры.

Окно "Редактировать селектор" позволяет просмотреть автоматически сгенерированный селектор и изменить сам селектор и его атрибуты.  Вы можете включать или исключать определенные атрибуты или добавлять подстановочные знаки в динамически изменяющиеся значения.

При нажатии на кнопку с многоточием справа от поля "Селектор", появится окно редактирования селектора.

<table data-header-hidden><thead><tr><th width="104"></th><th width="245"></th><th></th></tr></thead><tbody><tr><td><strong>№ п/п</strong></td><td><strong>Элемент интерфейса</strong></td><td><strong>Описание</strong></td></tr><tr><td>1.</td><td>кнопка “Конвертер селекторов UiPath…”</td><td>Позволяет открыть окно для ввода текста из поля Selector активности UIPath.</td></tr><tr><td>1.1.</td><td>кнопка <img src="https://lh7-rt.googleusercontent.com/docsz/AD_4nXeU5XOKxdixXFJw3rPuUFD8cZpF4UulMjnL2NVSVpa60-EYLgMvDU8oEKwZWuo8-_Vq4k8--Iom4ivb3GajuIT0Bez4ZUg2cJdqRe9dPX91IUp_RyQ1Hm5gn0U14Qm3z2l73q36YDEyqbhfm62zbRXO27sk?key=QcJUoh8mLAmXqxEVD8uJXA" alt=""></td><td>Позволяет открыть перейти к возможности переключить режим работы UIPath.</td></tr><tr><td>3.</td><td>кнопка “Добавить новую строку”</td><td>Позволяет добавить новую строку.</td></tr><tr><td>4.</td><td>кнопка “Удалить строку”</td><td>Позволяет удалить выбранную строку.</td></tr><tr><td>5.</td><td>кнопка “Вставить из буфера обмена”</td><td>Позволяет вставить информацию из буфера обмена.</td></tr><tr><td>6.</td><td>кнопка “Открыть Sherpa Explorer”</td><td>Позволяет открыть .Sherpa Explorer </td></tr><tr><td>7.</td><td>кнопка “Вставить модификатор”</td><td><p>Позволяет вставить модификатор, который можно выбрать из выпадающего списка. Возможные варианты:</p><ul><li>? (один любой символ);</li><li>* (несколько любых символов);</li><li>xpath: (обработка XPath);</li><li>regex: (обработка Regex).</li></ul></td></tr><tr><td>8.</td><td>кнопка “Вставить переменную”</td><td>Позволяет вставить переменную из числа заданных в диаграмме, которую можно выбрать с помощью выпадающего списка.</td></tr><tr><td>9.</td><td>кнопка “Запись”</td><td>Позволяет запустить процедуру записи селектора.</td></tr><tr><td>10.</td><td>кнопка “Проверить”</td><td>Позволяет проверить заданное в селекторе позиционирование элемента.</td></tr><tr><td>11.</td><td>кнопка “Подсветить”</td><td>Позволяет “подсветить” (указать) элемент самый последний элемент селектора.</td></tr><tr><td>11.1.</td><td>кнопка <img src="https://lh7-rt.googleusercontent.com/docsz/AD_4nXeU5XOKxdixXFJw3rPuUFD8cZpF4UulMjnL2NVSVpa60-EYLgMvDU8oEKwZWuo8-_Vq4k8--Iom4ivb3GajuIT0Bez4ZUg2cJdqRe9dPX91IUp_RyQ1Hm5gn0U14Qm3z2l73q36YDEyqbhfm62zbRXO27sk?key=QcJUoh8mLAmXqxEVD8uJXA" alt=""></td><td>Позволяет подсветить путь (т.е., каждую строку селектора). Данная кнопка позволяет увидеть, как именно происходит поиск селектора в интерфейсе окна.</td></tr><tr><td>12.</td><td>кнопка “Удалить селектор”</td><td>Позволяет удалить селектор.</td></tr></tbody></table>

<figure><img src="../../../../.gitbook/assets/image (77).png" alt=""><figcaption></figcaption></figure>

В данном окне можно посмотреть, как выглядит селектор, проверить и исправить его при необходимости, а также обогатить селектор вспомогательными инструментами, например, вставкой подстановочных символов, вставкой значения переменной. Также можно удалить лишние строки или очистить лишние значения ячеек.

Итак, селектор – это таблица, состоящая из колонок и срок, при этом каждая строка – некая команда, шаг, который робот должен выполнить. Команды читаются сверху вниз. Верхняя строка выполняется самой первой, нижняя самой последней. Робот идёт по шагам сверху вниз и выполняет каждую строку как команду. Он ищет на экране элемент, у которого все свойства одновременно равны тому, что указано в колонках строки селектора.

Например, рассмотрим первую строку селектора, где:

* &#x20;Тип – процесс. Т.е. эта строка ищет необходимое приложение для запуска.
* &#x20;Имя процесса здесь – Calculator, оно записано так, как фигурирует в диспетчере задач.

<figure><img src="../../../../.gitbook/assets/image (78).png" alt=""><figcaption></figcaption></figure>

Итак, на первом этапе робот найдет процесс с названием Calculator среди запущенных процессов в памяти компьютера.

Следующая строка обозначается как UIElement, это уже окно или какой-то конкретный элемент управления этого селектора. Для того, чтобы найти нужный элемент управления, робот одновременно будет искать элемент с именем Калькулятор, указанным именем класса и элементом управления Window, отсюда понятно, что речь идёт об окне. Данная строка позволяет найти конкретное окно калькулятора.

Спускаемся на строку ниже. Теперь в найденном окне необходимо найти последовательно все контейнеры, которые приведут к нужной кнопке. Таких контейнеров здесь три. Данные контейнеры могут визуально не отображаться в приложении, т.к. они были созданы для разработчиков. Однако по названию “Числовая панель” можно догадаться, что это контейнер, содержащий все кнопки калькулятора. И далее видим, что самый последний элемент – та самая цифра 6, на которую кликал пользователь.

Кнопка "**Проверить"** проверяет заданное в селекторе позиционирование элемента, то есть в результате Проверки может выдаваться два состояния:

* Ошибка при проверке

<figure><img src="https://lh7-rt.googleusercontent.com/docsz/AD_4nXe2xLoGirjfMaMRznbU-16_QpuPtYbyJ4JwdTGOcmV3COLh8frIAM0FiEnCsk5Vksf0r-eLQ5dVyNlUJukTblSH46pV4ByCK6cyrcxE9zWQg6xz9GXvgwafcr2A8t15rE0Yn3VDX_Pc0VO9mc3IwoXGsRcy?key=QcJUoh8mLAmXqxEVD8uJXA" alt=""><figcaption></figcaption></figure>

* Проверка прошла успешно, элемент с заданным в Селекторе положением найден на экране.

<figure><img src="https://lh7-rt.googleusercontent.com/docsz/AD_4nXdy76SNBB0sntIUViZzmmy9nyFoBwAuLBsmcW36-C63ngLY5AVZp0QFycu81vPxJ1957gD-xLWmbYlj5hNhDL2y9LXkdtN0y7WFueRmgFdCEUc0VcmkYzLleFvXQU1NcwKbhnDUDsdjOJz4mgr6slBX9Vep?key=QcJUoh8mLAmXqxEVD8uJXA" alt=""><figcaption></figcaption></figure>

Кнопка "**Подсветить" —** указывает на элемент пользовательского интерфейса, подсвечивает сам элемент и элементы верхнего уровня на пути к нему красными рамками. Выделение пропадает автоматически через несколько секунд.

Кнопка "**Запись"** – запускает процедуру записи Селектора путем клика на нужном элементе управления на экране.

Зайдите в Selector и нажмите "Запись". Окно **SherpaDesigner** (с открытым окном "Редактировать селектор") сворачивается. В верхней части экрана появится подсказка для работы в режиме Записи. Выбирайте нужное действие для вашего бизнес-процесса, то есть нужный элемент на экране и кликайте на него. Обратите внимание, элементы перед кликом должны подсветиться (то есть должна появиться красная рамка).&#x20;

<figure><img src="https://lh7-rt.googleusercontent.com/docsz/AD_4nXd_DYBBQ3OPhjyFt4M9bO0UsEgxhcdjWRrwxvy7yk71TVFh8ed_129s0hHy49zueYcI6Hws-DcHylVecYHG8m2mRnyWDWczyZwsUHiJ_plp4IeJrbTDUG65Kn0wqODnubrZdE0CLEc6FXxR0-lVY7RaQeYM?key=QcJUoh8mLAmXqxEVD8uJXA" alt=""><figcaption></figcaption></figure>

Если подсветка не появляется автоматически или пропадает, то для подсветки нужного элемента, необходимо нажать клавишу Shift на клавиатуре. Подсветка нужна, чтобы точно выбрать элемент под мышкой.

Варианты записи клика:

* кликнуть левой кнопкой мыши;
* нажать левый Ctrl, что эмулирует нажатие клика левой кнопкой мыши;
* нажать правый Ctrl, что эмулирует нажатие правой кнопки мыши, то есть, во многих приложениях, вызов контекстного меню;
* эмуляция задержки курсора мыши над элементом записывается с помощью клавиши Shift.

**Примечание:** _из окна “Редактировать селектор” записывается только одно действие (клик, вставка, зависание над кнопкой и т.д.), в отличие от использования инструмента записи через основное меню, когда вы можете записать несколько действий сразу. То есть, после совершения действия (клика) пользователь автоматически возвращается в окно “Редактировать селектор”._

После возврата в окно редактирования Селектора рекомендуем использовать кнопки «Подсветить» или «Проверить», чтобы проверить правильно ли выбран элемент. Если элемент выбран неправильно, то можно повторить попытку, нажав кнопку Запись, или найти и исправить ошибку в строках Селектора вручную.

## **Настройка селектора**

<figure><img src="../../../../.gitbook/assets/image (79).png" alt=""><figcaption></figcaption></figure>

Каждая строка селектора имеет один или несколько атрибутов, помогающих правильно идентифицировать точное местоположение выбранного участка экрана. Атрибуты отображают, в какой программе идет запись, в каком окне и элементе, а также конкретный уровень выбранного элемента с помощью таких атрибутов как Type, Name, ClassName, ControlType, Index, Id, Text. Каждый атрибут может имеет присвоенное значение, по которому будет осуществляться поиск.  Важно выбрать атрибуты с постоянным значением. Если значение атрибута изменяется при каждом запуске приложения, то селектор не сможет правильно идентифицировать элемент. В этом случае рекомендуем отказаться от использования данного атрибута (оставить его значение пустым).

<table data-header-hidden><thead><tr><th width="100"></th><th width="169"></th><th></th></tr></thead><tbody><tr><td><strong>№ п/п</strong></td><td><strong>Атрибут</strong></td><td><strong>Описание атрибута</strong></td></tr><tr><td>1.</td><td>Type</td><td>Тип элемента.</td></tr><tr><td>2.</td><td>Name</td><td>Имя элемента.</td></tr><tr><td>3.</td><td>ClassName</td><td>Имя класса элемента.</td></tr><tr><td>4.</td><td>ControlType</td><td>Тип элемента управления (например, кнопка, текстовое поле и т. д.).</td></tr><tr><td>5.</td><td>Id</td><td>Идентификатор элемента (обычно уникальный для каждого элемента).</td></tr><tr><td>6.</td><td>Index</td><td>Индекс элемента в списке подходящих элементов.</td></tr><tr><td>7.</td><td>Text</td><td>Текст внутри элемента.</td></tr></tbody></table>

Кроме того, в сложных случаях вы можете воспользоваться символами замены или подстановкой значения атрибута или части атрибута из переменной:

* Звездочка (\*) заменяет любое количество символов в значении атрибута;
* Знак вопроса (?) заменяет один символ в значении атрибута;
* $ИмяПеременной – использование имени переменной, начинающегося на символ $, позволяет вставить значение этой переменной вместо значения атрибута или его части.

Видео с демонстрацией работы с селекторами:

* [Запись селекторов: перекрывающихся или невидимых элементов на примере окна авторизации Chrome](https://sherparpa.ru/ucontent/?09)
* [Работа с селекторами окна "Загрузки" Chrome](https://sherparpa.ru/ucontent/?42zd)
* [Запись селекторов всплывающего окна в Internet Explorer](https://sherparpa.ru/ucontent/?LSpu)
* [Конвертация селекторов UIPath > Sherpa RPA в окне "Редактировать селектор"](https://sherparpa.ru/ucontent/?gHJc)
* [Работа функции "Подсветить путь" в окне "Редактировать селектор"](https://sherparpa.ru/ucontent/?gMbc)
* [Работа с браузером Firefox](https://sherparpa.ru/ucontent/?gadx)

Полноценное руководство по работе с веб-селекторами находится [здесь](../../rukovodstvo-po-veb-selektoram/).
